#!/bin/bash

set -e

BUILD_DIR="$1"
ENV_DIR="$3"
DIST_DIR="$BUILD_DIR/.heroku/lxml"
LIB_DIR="$DIST_DIR/lib"
PY_DIR="$DIST_DIR/py"

mkdir -p $DIST_DIR

echo "-----> lxml-buildpack: Installing lxml to $DIST_DIR"

echo "       Installing sources"
tar -C $DIST_DIR -xzf dist.tar.gz

echo "       Setting LD_LIBRARY_PATH=\"$LIB_DIR\""
echo -n $LIB_DIR > "$ENV_DIR/LD_LIBRARY_PATH"

echo "       Setting PYTHONPATH=\"$PY_DIR:/app\""
echo -n $PY_DIR > "$ENV_DIR/PYTHONPATH"
